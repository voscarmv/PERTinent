<h1>Work breakdown structure</h1>

<% @rows.each { |r| %>
  <div class="d-flex justify-content-around m-5">
  <% r.each { |node| %>
    <% if node.id == @link.from_id %>
    <div class="rounded bg-danger p-3 node" id="n_<%= node.id %>">
      <h2><%= node.name %></h2>
    </div>
    <% else %>
    <div class="rounded bg-success p-3 node" id="n_<%= node.id %>">
      <h2><%= node.name %></h2>
      <%= link_to 'Connect here', links_path(link: {from_id: @link.from_id, to_id: node.id, project_id: @link.project_id}), method: :post, class: "btn btn-primary btn-sm text-white" %>
    </div>
    <% end %>
  <% } %>
  </div>
  <div class="d-flex m-5"></div>
  <div class="d-flex m-5"></div>
<% } %>

<svg xmlns="http://www.w3.org/2020/svg" id="svg_bg" style="width:100%; position: absolute; top: 0; z-index: -1;">
  <defs>
    <marker id="arrowheadfuchsia" viewBox="0 0 10 10" refX="3" refY="5" markerWidth="6" markerHeight="6" orient="auto" stroke="fuchsia" fill="fuchsia">
      <path d="M 0 0 L 10 5 L 0 10 z" />
    </marker>
    <marker id="arrowheadcyan" viewBox="0 0 10 10" refX="3" refY="5" markerWidth="6" markerHeight="6" orient="auto" stroke="cyan" fill="cyan">
      <path d="M 0 0 L 10 5 L 0 10 z" />
    </marker>
    <marker id="arrowheadblack" viewBox="0 0 10 10" refX="3" refY="5" markerWidth="6" markerHeight="6" orient="auto" stroke="black" fill="black">
      <path d="M 0 0 L 10 5 L 0 10 z" />
    </marker>
  </defs>
  <g fill="none" stroke="black" stroke-width="4" marker-end="url(#arrowheadblack)">
    
    <% (0..@edges.length).each { |i| %>
    <path id="e_<%= i %>"/>
    <% } %>
  </g>
</svg>

<script>
  const edges = <%= @edges.to_s %>;
  console.log(edges);
</script>

<%= javascript_pack_tag 'arrows' %>

<h1>New Link</h1>

<%= render 'form', link: @link %>

<%= link_to 'Back', links_path %>
