<h1>Work breakdown structure</h1>

<% @rows.each { |r| %>
  <div class="d-flex justify-content-around m-5">
  <% r.each { |node| %>
    <div class="rounded bg-success opacity-90 p-3 node" id="n_<%= node.id %>">
      <h2><%= node.name %></h2>
      <ul>
        <li><%= link_to 'Add subtask', new_node_path(link: {parent_node: node.id}, node: {project_id: @project.id})%></li>
        <li><%= link_to 'Connect to task', new_link_path(link: {from_id: node.id, project_id: @project.id})%></li>
      </ul>
    </div>
  <% } %>
  </div>
  <div class="d-flex m-5"></div>
  <div class="d-flex m-5"></div>
<% } %>

<svg xmlns="http://www.w3.org/2020/svg" id="svg_bg" style="width:100%; position: absolute; top: 0; z-index: -1;">
  <defs>
    <marker id="arrowheadfuchsia" viewBox="0 0 10 10" refX="3" refY="5" markerWidth="6" markerHeight="6" orient="auto" stroke="fuchsia" fill="fuchsia">
      <path d="M 0 0 L 10 5 L 0 10 z" />
    </marker>
    <marker id="arrowheadcyan" viewBox="0 0 10 10" refX="3" refY="5" markerWidth="6" markerHeight="6" orient="auto" stroke="cyan" fill="cyan">
      <path d="M 0 0 L 10 5 L 0 10 z" />
    </marker>
    <marker id="arrowheadblack" viewBox="0 0 10 10" refX="3" refY="5" markerWidth="6" markerHeight="6" orient="auto" stroke="black" fill="black">
      <path d="M 0 0 L 10 5 L 0 10 z" />
    </marker>
  </defs>
  <g fill="none" stroke="black" stroke-width="2" marker-end="url(#arrowheadblack)">
    
    <% (0..@edges.length).each { |i| %>
    <path id="e_<%= i %>"/>
    <% } %>
  </g>
</svg>

<script>
  const edges = <%= @edges.to_s %>;
  const nodes = <%= @vertices.to_s %>
</script>

<%= javascript_pack_tag 'arrows' %>

<p id="notice"><%= notice %></p>

<p>
  <strong>Name:</strong>
  <%= @project.name %>
</p>

<p>
  <strong>Description:</strong>
  <%= @project.description %>
</p>

<p>
  <strong>User:</strong>
  <%= @project.user_id %>
</p>

<%= link_to 'Edit', edit_project_path(@project) %> |
<%= link_to 'Back', projects_path %>
